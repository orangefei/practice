# For advice on how to change settings please see
# http://dev.mysql.com/doc/refman/5.6/en/server-configuration-defaults.html
# *** DO NOT EDIT THIS FILE. It's a template which will be copied to the
# *** default location during install, and will be replaced if you
# *** upgrade to a newer version of MySQL.

[mysqld]

# Remove leading # and set to the amount of RAM for the most important data
# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.
# innodb_buffer_pool_size = 128M

# Remove leading # to turn on a very important data integrity option: logging
# changes to the binary log between backups.
# log_bin

# These are commonly set, remove the # and set as required.
# basedir = .....
# datadir = .....
# port = .....
# server_id = .....
# socket = .....

# Remove leading # to set options mainly useful for reporting servers.
# The server defaults are faster for transactions and fast SELECTs.
# Adjust sizes as needed, experiment to find the optimal values.
# join_buffer_size = 128M
# sort_buffer_size = 2M
# read_rnd_buffer_size = 2M 

#生产数据库硬件配置：64g内存 1.5t盘 cpucores: 12  cpuMHz: 2199.929


#NO_ENGINE_SUBSTITUTION：
启用后，若需要的存储引擎被禁用或未编译，则抛出错误；未启用时将用默认的存储引擎代替，并抛出一个异常
#STRICT_TRANS_TALES（严格模式）：
只对支持事务的表启用严格模式

sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES 
[client]
port            = 3306
socket          = /tmp/mysql.sock

#mysql命令行工具自带这个功能，但是默认是禁用的。想启用其实很简单，打开配置文件找到no-auto-rehash，用符号 # 将其注释，另外增加auto-rehash即可
[mysql]
no-auto-rehash
default-character-set=utf8

[mysqld]
basedir         = /usr/local/mysql
datadir         = /data/mysqldb
port            = 3306
socket          = /tmp/mysql.sock
init-connect='SET NAMES utf8'
character-set-server = utf8



key_buffer_size = 512M  #key_buffer_size这个参数是用来设置索引块（index blocks）缓存的大小，它被所有线程共享，严格说是它决定了数据库索引处理的速度，尤其是索引读的速度。
max_allowed_packet = 512M #MySQL会根据配置文件会限制server接受的数据包的大小。如果写入大数据时，因为默认的配置太小，插入和更新操作会因为 max_allowed_packet 参数限制，而导致失败。
table_open_cache = 1024 #table_open_cache指定表高速缓存的大小。每当MySQL访问一个表时，如果在表缓冲区中还有空间，该表就被打开并放入其中，这样可以更快地访问表内容
sort_buffer_size = 1M
net_buffer_length = 1m
read_buffer_size = 32m
read_rnd_buffer_size = 16m
myisam_sort_buffer_size = 128M
max_connections = 3000 #最大连接数
max_user_connections = 1000
max_connect_errors = 100
#max_user_connections：限制每个用户的session连接个数，例如max_user_connections=1 ，那么用户u1只能连接的session数为1，如果还有用户u2，还是可以连接，但是连接数仍然为1
#max_connections ：是对整个服务器的用户限制，整个服务器只能开这么多session，而不考虑用户！
sync_binlog = 1
open_files_limit = 65535 
back_log = 300   
join_buffer_size = 16M
thread_cache_size = 300 
thread_concurrency = 32 
query_cache_size = 128M 
query_cache_limit = 4M 
query_cache_min_res_unit = 4k 
thread_stack = 512K
transaction_isolation = READ-COMMITTED
tmp_table_size = 128M 
max_heap_table_size = 256M
log_slave_updates=1

#########开启慢日志log#############
long_query_time = 3
slow_query_log = 1
slow_query_log_file = /data/log/crf_slow.log
log-error = /data/log/alert_error.log
pid-file = /data/log/crf_master.pid



#############Thread pool#############
###thread_handling = pool-of-threads
###thread_pool_size = 128
###thread_pool_max_threads = 1000
###thread_pool_oversubscribe = 25


skip-name-resolve
skip-slave-start


##########binlog#########
log-bin = /data/mysqldb/crf_master-bin
binlog_format = ROW
expire_logs_days = 7
max_binlog_size = 512M

##### ***  Replication related settings 
replicate-ignore-db=mysql
replicate-wild-ignore-table=mysql.%
replicate-ignore-db=test
replicate-wild-ignore-table=test.%
replicate-ignore-db=sys
replicate-wild-ignore-table=sys.%
replicate-ignore-db=cdsv5_where
replicate-wild-ignore-table=cdsv5_where.%
replicate-ignore-db=crf_qunar
replicate-wild-ignore-table=crf_qunar.%
#auto_increment_offset=1
#auto_increment_increment=2

##sql_mode=''

server-id = 10741
innodb_buffer_pool_instances = 1
default-storage-engine = INNODB
character-set-server = utf8
lower_case_table_names = 1
skip-external-locking
local-infile = 1
net_read_timeout = 5000
net_write_timeout = 5000

##########innodb#########
innodb_data_home_dir = /data/mysqldb
innodb_data_file_path = ibdata1:4G:autoextend
innodb_log_group_home_dir = /data/mysqldb
innodb_additional_mem_pool_size = 512M  
innodb_buffer_pool_size = 40G  
innodb_sort_buffer_size = 2m
innodb_log_files_in_group = 3
innodb_log_file_size = 512M
innodb_log_buffer_size = 16M
innodb_flush_log_at_trx_commit = 2
innodb_max_dirty_pages_pct = 90
innodb_io_capacity = 300
innodb_read_io_threads = 32
innodb_write_io_threads = 32
innodb_open_files = 1000
innodb_file_per_table = 1
innodb_flush_method = O_DIRECT
innodb_lock_wait_timeout = 120
innodb_rollback_on_timeout = 0
innodb_purge_threads = 1
innodb_strict_mode = 1
transaction-isolation = READ-COMMITTED

[mysqldump]
quick
max_allowed_packet = 512M

[isamchk] 
key_buffer = 512M 
sort_buffer_size = 512M 
read_buffer = 8M 
write_buffer = 8M 

[myisamchk] 
key_buffer = 512M 
sort_buffer_size = 512M 
read_buffer = 8M 
write_buffer = 8M

[mysqlhotcopy]
interactive-timeout
